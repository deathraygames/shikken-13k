!function(){function i(e="U"){return[e,f(9999).toString(36),Number(new Date).toString(36)].join("-")}function r(e={},t=null){if(e={key:i("B"),type:"connector",T:!0,resources:["wood","stone","wood","grain"],x:f(1e3),y:f(1e3),...e},p.h[e.key])throw Error("Existing building");if(console.log("Adding building",e),p.h[e.key]=e,p.C.push(e.key),t){var[t,n,o={}]=[e.key,t],r=t<n;if(t={key:i("R"),from:r?t:n,J:r?n:t,length:0,...o},p.A[t.key])throw Error("Existing building");p.A[t.key]=t,p.D.push(t.key)}return e}function o(){(t=document.querySelector("main").classList).toggle("bselected",p.g),t.toggle("looping",p.j),t.toggle("creating",p.i),t.toggle("pop",0<p.K),p.s||(p.s=document.getElementById("cd"));var e=p.o,t=Math.floor(1/60*e*.001),e=Math.floor(.001*(e-6e4*t));p.s.innerText=t+":"+(e<10?"0":"")+e,p.i&&(document.getElementById("blist").innerHTML=Object.keys(E).map(e=>`<li>${e}</li>`).join(""))}function l(){var i,e=p.B;e.u.style.top=e.y+"px",e.u.style.left=e.x+"px",i=e.H,p.C.forEach(e=>{var t,n,o=p.h[e],r=document.getElementById(e);r||(t=i.F,r=E[o.type],console.log(o,r),(t=u("g",t)).id=o.key,n=u("circle",t),y(n,{cx:o.x,cy:o.y,r:r.r,G:"building building-"+o.type}),r=t),o.resources.forEach(()=>{}),r.classList.toggle("selectedb",e===p.g)}),p.D.forEach(e=>{var t,n=p.A[e];document.getElementById(e)||((e=u("line",i.I)).id=n.key,t=p.h[n.from],n=p.h[n.J],y(e,{x1:t.x,y1:t.y,x2:n.x,y2:n.y,G:"road"}))}),o()}function n(){var e,t;p.j&&(e=Number(new Date),t=p.v?e-p.v:0,p.v=e,p.o-=t,o(),setTimeout(n,100))}function d(){p.j=!0,n()}function c(){p.j=!1}function a(e){var t=e.target,n=t.classList;let o="";if(n.contains("building")){if(e=p.h[t.closest("g").id],console.log(t),!e)throw Error("Unknown building "+t.id);o=e.type,p.g=e.key}else p.i&&p.g?(t=r({x:e.clientX,y:e.clientY,type:"connector"},p.g),o=t.type,p.g=t.key,p.i=!1):(p.g=null,n.contains("road")&&(o="road"));document.getElementById("binfo").innerHTML=o,l()}function s(){}function g(e){const t=e.target,n=(console.log(t),{"#play":d,"#pause":c,"#build":()=>p.i=!0,"#cancel":()=>p.i=!1,"#restart":()=>window.location.reload()});Object.keys(n).forEach(e=>{t.closest(e)&&n[e]()}),o()}const u=(e,t)=>(e=document.createElementNS("http://www.w3.org/2000/svg",e),t.appendChild(e),e),y=(t,n)=>Object.keys(n).forEach(e=>t.setAttribute(e,n[e])),m=(e=1,t=0)=>t+(e-t)*Math.random(),f=(e=1,t=0)=>0|m(e,t),E={M:{r:10,l:4,m:["stone"]},W:{r:14,l:2,m:["stone","wood","wood"]},O:{r:20,l:10,m:["wood","wood"]},L:{r:20,l:2,m:["wood","wood"]}},p=window.R={state:"game",B:{},h:{},C:[],P:{},A:{},D:[],g:null,s:null,v:0,o:3e5,j:!1,i:!1,K:0,start:function(){console.log("hello shikken");var e=document.getElementById("wc"),n=document.getElementById("w");p.B={c:e,u:n,V:document.getElementById("ws"),N:e.getContext("2d"),H:{I:document.getElementById("layer-road"),F:document.getElementById("layer-building"),U:document.getElementById("layer-resource"),S:document.getElementById("layer-meeple")},x:0,y:0};{var o=p.B;n=o.u;let t;n.addEventListener("dragstart",e=>{e.dataTransfer.setData("text/plain","w"),e.dataTransfer.effectAllowed="move",t=e}),n.addEventListener("drop",e=>{o.x+=e.clientX-t.clientX,o.y+=e.clientY-t.clientY,l()}),document.querySelector("main").addEventListener("dragover",e=>{e.preventDefault()}),n.addEventListener("pointerdown",a),document.getElementById("bui").addEventListener("pointerdown",g),document.getElementById("tui").addEventListener("pointerdown",s)}e=r({type:"connector"}),r({type:"connector"},e.key),l(w)}};document.addEventListener("DOMContentLoaded",p.start)}();