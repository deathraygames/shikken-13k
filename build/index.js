!function(){function l(e="U"){return[e,n(9999).toString(36),Number(new Date).toString(36)].join("-")}function r(e,t,n={}){var o=e<t;if(e={key:l("R"),from:o?e:t,N:o?t:e,length:0,...n},v.C[e.key])throw Error("Existing building");v.C[e.key]=e,v.I.push(e.key)}function i(e={},t=null){if(e={key:l("B"),type:"connector",X:!0,resources:["wood","stone","wood","grain"],x:n(1e3),y:n(1e3),...e},v.i[e.key])throw Error("Existing building");return console.log("Adding building",e),v.i[e.key]=e,v.F.push(e.key),t&&r(e.key,t),e}function t(e={}){if(e={key:l("M"),H:"idle",W:100,R:null,aa:null,P:null,path:[],x:n(1e3),y:n(1e3),...e},v.o[e.key])throw Error("Existing meeple");console.log("Adding meeple",e),v.o[e.key]=e,v.m.push(e.key)}function o(){(t=document.querySelector("main").classList).toggle("bselected",v.h),t.toggle("looping",v.l),t.toggle("creating",v.g),t.toggle("pop",0<v.m.length),v.A||(v.A=document.getElementById("cd"));var e=v.v,t=Math.floor(1/60*e*.001),e=Math.floor(.001*(e-6e4*t));v.A.innerText=t+":"+(e<10?"0":"")+e,v.g&&(document.getElementById("blist").innerHTML=Object.keys(h).map(e=>`<li>${e}</li>`).join(""))}function c(){var r,e=v.D;e.B.style.top=e.y+"px",e.B.style.left=e.x+"px",r=e.K,v.F.forEach(e=>{var t,n,o=v.i[e],l=document.getElementById(e);l||(t=r.J,l=h[o.type],console.log(o,l),(t=f("g",t)).id=o.key,n=f("circle",t),E(n,{cx:o.x,cy:o.y,r:l.r,G:"building building-"+o.type}),l=t),o.resources.forEach(()=>{}),l.classList.toggle("selectedb",e===v.h)}),v.I.forEach(e=>{var t,n=v.C[e];document.getElementById(e)||((e=f("line",r.M)).id=n.key,t=v.i[n.from],n=v.i[n.N],E(e,{x1:t.x,y1:t.y,x2:n.x,y2:n.y,G:"road"}))}),v.m.forEach(e=>{var t=v.o[e];(e=document.getElementById(e))||((e=f("circle",r.L)).id=t.key,E(e,{cx:0,cy:0,r:7,G:"meeple meeple-"+t.H})),e.style.cx=t.x,e.style.cy=t.y}),o()}function d(){var e,t,n;v.l&&(e=Number(new Date),t=v.j?e-v.j:0,v.j=e,v.v-=t,n=t,v.m.forEach(e=>{var t;"idle"===(e=v.o[e]).H&&(e.x+=(t=.05*n)*(2*(0|p(2))-1),e.y+=t*(2*(0|p(2))-1))}),c(),setTimeout(d,100))}function a(){v.l=!0,v.j=0,d()}function s(){v.l=!1}function u(e){return v.h=e.key,e.type+" : "+e.resources.join(", ")}function y(e){var t=e.target,n=t.classList;let o="";n.contains("building")?(e=v.i[t.closest("g").id],v.g&&v.h&&(r(e.key,v.h),v.g=!1),o=u(e)):v.g&&v.h?(v.g=!1,e=i({x:e.clientX,y:e.clientY,type:"connector"},v.h),o=u(e)):(v.h=null,n.contains("road")&&(o="road")),document.getElementById("binfo").innerHTML=o,c()}function g(){}function m(e){const t=e.target,n=(console.log(t),{"#play":a,"#pause":s,"#build":()=>v.g=!0,"#cancel":()=>v.g=!1,"#restart":()=>window.location.reload()});Object.keys(n).forEach(e=>{t.closest(e)&&n[e]()}),o()}const f=(e,t)=>(e=document.createElementNS("http://www.w3.org/2000/svg",e),t.appendChild(e),e),E=(t,n)=>Object.keys(n).forEach(e=>t.setAttribute(e,n[e])),p=(e=1,t=0)=>t+(e-t)*Math.random(),n=(e=1,t=0)=>0|p(e,t),h={S:{r:10,s:4,u:["stone"]},$:{r:14,s:2,u:["stone","wood","wood"]},U:{r:20,s:10,u:["wood","wood"]},O:{r:20,s:2,u:["wood","wood"]}},v=window.V={state:"game",D:{},i:{},F:[],o:{},m:[],C:{},I:[],h:null,A:null,j:0,v:3e5,l:!1,g:!1,start:function(){console.log("hello shikken");var e=document.getElementById("wc"),n=document.getElementById("w");v.D={c:e,B:n,Z:document.getElementById("ws"),T:e.getContext("2d"),K:{M:document.getElementById("layer-road"),J:document.getElementById("layer-building"),Y:document.getElementById("layer-resource"),L:document.getElementById("layer-meeple")},x:0,y:0};{var o=v.D;n=o.B;let t;n.addEventListener("dragstart",e=>{e.dataTransfer.setData("text/plain","w"),e.dataTransfer.effectAllowed="move",t=e}),n.addEventListener("drop",e=>{o.x+=e.clientX-t.clientX,o.y+=e.clientY-t.clientY,c()}),document.querySelector("main").addEventListener("dragover",e=>{e.preventDefault()}),n.addEventListener("pointerdown",y),document.getElementById("bui").addEventListener("pointerdown",m),document.getElementById("tui").addEventListener("pointerdown",g)}e=i({type:"connector"}),i({type:"connector"},e.key),t(),t(),t(),c(w)}};document.addEventListener("DOMContentLoaded",v.start)}();