!function(){function l(e="U"){return[e,g(9999).toString(36),Number(new Date).toString(36)].join("-")}function t(e={},t=null){if(e={key:l("B"),type:"connector",resources:[],x:g(1e3),y:g(1e3),...e},y.g[e.key])throw Error("Existing building");if(console.log("Adding building",e),y.g[e.key]=e,y.o.push(e.key),t){var[t,n,o={}]=[e.key,t],r=t<n;if(t={key:l("R"),from:r?t:n,C:r?n:t,length:0,...o},y.j[t.key])throw Error("Existing building");y.j[t.key]=t,y.s.push(t.key)}return e}function r(){var o,e=y.m;e.i.style.top=e.y+"px",e.i.style.left=e.x+"px",o=e.A,y.o.forEach(e=>{var t,n=y.g[e];document.getElementById(e)||(t=o.u,e=u[n.type],console.log(n,e),(t=a("g",t)).id=n.key,t=a("circle",t),s(t,{cx:n.x,cy:n.y,r:e.r,v:"building building-"+n.type}))}),y.s.forEach(e=>{var t,n=y.j[e];document.getElementById(e)||((e=a("line",o.B)).id=n.key,t=y.g[n.from],n=y.g[n.C],s(e,{x1:t.x,y1:t.y,x2:n.x,y2:n.y,v:"road"}))})}function d(e){var t=(e=e.target).classList;let n="";if(t.contains("building")){if(t=y.g[e.closest("g").id],console.log(e),!t)throw Error("Unknown building "+e.id);n=t.type,y.l=t}else y.l=null,t.contains("road")&&(n="road");document.getElementById("binfo").innerHTML=n,document.querySelector("main").classList.toggle("bselected",y.l)}function i(){}function c(e){e=e.target,console.log(e),e.closest("#play")&&console.log("play/pause")}const a=(e,t)=>(e=document.createElementNS("http://www.w3.org/2000/svg",e),t.appendChild(e),e),s=(t,n)=>Object.keys(n).forEach(e=>t.setAttribute(e,n[e])),n=(e=1,t=0)=>t+(e-t)*Math.random(),g=(e=1,t=0)=>0|n(e,t),u={F:{r:10,h:4},N:{r:14,h:2},H:{r:20,h:10},D:{r:20,h:2}},y=window.J={state:"game",m:{},g:{},o:[],I:{},j:{},s:[],l:null,start:function(){console.log("hello shikken");var e=document.getElementById("wc"),n=document.getElementById("w");y.m={c:e,i:n,M:document.getElementById("ws"),G:e.getContext("2d"),A:{B:document.getElementById("layer-road"),u:document.getElementById("layer-building"),L:document.getElementById("layer-resource"),K:document.getElementById("layer-meeple")},x:0,y:0};{var o=y.m;n=o.i;let t;n.addEventListener("dragstart",e=>{e.dataTransfer.setData("text/plain","w"),e.dataTransfer.effectAllowed="move",t=e}),n.addEventListener("drop",e=>{o.x+=e.clientX-t.clientX,o.y+=e.clientY-t.clientY,r()}),document.querySelector("main").addEventListener("dragover",e=>{e.preventDefault()}),n.addEventListener("pointerdown",d),document.getElementById("bui").addEventListener("pointerdown",c),document.getElementById("tui").addEventListener("pointerdown",i)}e=t({type:"connector"}),t({type:"connector"},e.key),r(w)}};document.addEventListener("DOMContentLoaded",y.start)}();